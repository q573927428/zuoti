# 币安自动做T交易系统

一个基于Nuxt 4和Vue 3的自动化交易系统，用于执行币安现货日内做T策略。系统采用振幅交易策略，在价格波动区间内低买高卖，实现稳定收益。

## ✨ 核心功能

- ✅ **多交易对监控**：实时监控ETH/USDT、BTC/USDT、BNB/USDT、SOL/USDT等主流交易对
- ✅ **智能交易策略**：基于振幅和趋势的智能交易决策，自动寻找最佳交易机会
- ✅ **多层保护机制**：完整的熔断、止损、突破保护、跌破保护、超时保护等风险控制
- ✅ **状态持久化**：交易状态、配置数据自动保存，支持跨天自动重置
- ✅ **全自动运行**：自动下单、监控、卖出、撤单，无需人工干预
- ✅ **响应式UI界面**：基于Element Plus的现代化界面，支持移动端和桌面端
- ✅ **模拟交易支持**：支持币安模拟交易和真实交易一键切换
- ✅ **数据可视化**：实时展示交易统计、收益曲线、市场分析等图表
- ✅ **AI分析增强**：可选AI技术分析支持，提供更精准的交易建议

## 🛠️ 技术栈

- **前端框架**：Nuxt 4 + Vue 3 + TypeScript
- **UI组件库**：Element Plus
- **状态管理**：Pinia
- **图表库**：ECharts + vue-echarts
- **交易接口**：CCXT（加密货币交易库）
- **技术分析**：technicalindicators
- **任务调度**：node-cron
- **时间处理**：dayjs

## 🚀 快速开始

### 1. 环境准备

确保已安装 Node.js (>=18.0.0) 和 pnpm：

```bash
# 检查Node.js版本
node --version

# 安装pnpm（如果未安装）
npm install -g pnpm
```

### 2. 克隆项目

```bash
git clone https://github.com/q573927428/zuoti.git
cd zuoti
```

### 3. 安装依赖

```bash
pnpm install
```

### 4. 环境配置

复制环境变量文件并配置API密钥：

```bash
cp .env.example .env
```

编辑 `.env` 文件，配置币安API密钥：

```bash
# 币安API密钥（建议先使用模拟交易）
BINANCE_API_KEY=your_api_key_here
BINANCE_SECRET=your_secret_key_here
```

### 5. 启动系统

#### 开发模式（推荐）

```bash
pnpm dev
```

#### 生产模式

```bash
pnpm build
pnpm preview
```

访问：http://localhost:3000

## ⚙️ 系统配置

### 交易参数配置

在系统配置面板中可以调整以下参数：

- **投资金额**：每次交易投入的USDT金额（默认：20 USDT）
- **振幅阈值**：筛选交易对的最小振幅（默认：3%，基于回测优化）
- **趋势阈值**：过滤单边趋势的阈值（默认：5%）
- **价格区间比例**：买入/卖出价距离边界的比例（默认：12%）
- **交易对选择**：ETH/USDT, BTC/USDT, BNB/USDT, SOL/USDT

### 模拟交易设置

系统默认使用币安模拟交易（测试网），可在配置中切换：

- `isTestnet: true` - 使用币安模拟交易（默认，安全推荐）
- `isTestnet: false` - 使用币安真实交易（需谨慎）

### AI分析配置

系统集成了DeepSeek AI分析功能，提供智能交易建议。AI配置参数包括：

- **启用AI分析**：是否启用AI分析功能（默认：false）
- **分析间隔**：AI分析执行间隔（默认：10分钟）
- **最小置信度**：AI建议的最小置信度阈值（0-100，默认：60）
- **最大风险等级**：允许的最大风险等级（LOW/MEDIUM/HIGH，默认：MEDIUM）
- **用于买入决策**：是否将AI分析用于买入决策（默认：true）
- **用于卖出决策**：是否将AI分析用于卖出决策（默认：true）
- **缓存时长**：AI分析结果缓存时间（默认：10分钟）

#### DeepSeek API配置
要启用AI分析功能，需要在环境变量中配置DeepSeek API密钥：

```bash
# 在.env文件中添加以下配置
DEEPSEEK_API_KEY=your_deepseek_api_key_here
DEEPSEEK_API_URL=https://api.deepseek.com  # 可选，默认使用此URL
```

#### AI分析功能特点
1. **多维度分析**：结合价格变化、移动平均线、RSI、成交量、支撑阻力位等技术指标
2. **智能加权**：AI分析结果与本地技术指标加权计算最终置信度
3. **结果缓存**：分析结果自动缓存，减少API调用频率
4. **容错处理**：API调用失败时自动降级，不影响核心交易功能
5. **详细报告**：提供完整的分析理由和技术指标数据

## 📊 交易策略详解

### 策略核心逻辑

1. **机会发现**：每60秒分析所有交易对的15分钟K线数据
2. **振幅筛选**：计算6小时（24根15分钟K线）的振幅，筛选振幅≥3%的交易对
3. **趋势过滤**：排除单边趋势超过5%的交易对，避免逆势交易
4. **最佳选择**：从符合条件的交易对中选择振幅最大的进行交易
5. **价格计算**：在振幅区间内计算买入价和卖出价：
   - `BuyPrice = Low + 0.12 * Range`
   - `SellPrice = High - 0.12 * Range`
6. **限价挂单**：使用限价单而非市价单，精确控制交易成本
7. **每日限制**：每天最多完成一次完整交易（买入+卖出）

### 交易状态机

系统采用5状态状态机确保交易流程的完整性：

```
IDLE（空闲）
  ↓ 发现交易机会
BUY_ORDER_PLACED（买单已挂）
  ↓ 买单成交
BOUGHT（已买入）
  ↓ 挂出卖单
SELL_ORDER_PLACED（卖单已挂）
  ↓ 卖单成交
DONE（交易完成）
  ↓ 重置
IDLE（空闲）
```

## 🛡️ 多层保护机制

### 1. 熔断机制（Circuit Breaker）
- **连续失败限制**：5次连续失败后自动暂停交易
- **单日亏损限额**：单日亏损超过20 USDT自动暂停
- **总亏损限额**：总亏损超过100 USDT自动暂停
- **冷却时间**：熔断后12小时自动恢复

### 2. 止损机制（Stop Loss）
- **硬止损阈值**：-2%自动触发止损
- **执行价格折扣**：0.998（略低于市价确保成交）
- **等待确认时间**：5秒确认后执行

### 3. 保护机制（Protection）
- **突破保护**：价格突破上界时取消买单
- **跌破保护**：价格跌破下界时取消买单
- **市场反转保护**：价格跌破原区间下界时取消卖单
- **价格偏离保护**：卖单价格偏离当前价>2%时取消

### 4. 超时机制
- **买单超时**：1小时未成交自动取消
- **卖单超时**：2小时未成交自动取消
- **默认超时**：2小时（其他操作）

### 5. 日切机制
- **日切处理时间**：23:00自动处理跨日交易
- **日切预警时间**：22:30开始预警
- **强制平仓**：跨日未平仓头寸自动平仓

### 6. 交易限制
- **每日交易次数**：最多3次完整交易
- **交易间隔**：至少1小时间隔
- **余额安全缓冲**：保留5%余额作为安全缓冲

## 📈 回测与优化

### 回测结果

基于2年历史数据的回测分析显示：

- **推荐振幅阈值**：3%（原1%过低，过滤不足）
- **推荐价格区间比例**：12%（平衡收益与保护）
- **年化收益率**：15-25%（取决于市场条件）
- **胜率**：60-70%
- **最大回撤**：< 10%

### 参数优化建议

```javascript
const OPTIMIZED_CONFIG = {
  amplitudeThreshold: 0.03,      // 3% 振幅阈值（基于回测优化）
  priceRangeRatio: 0.12,         // 12% 价格区间比例
  trendThreshold: 5.0,           // 5% 趋势过滤
  investmentAmount: 20,          // 20 USDT/次
  dailyTradeLimit: 3,            // 每日最多3次交易
  tradeInterval: 3600000         // 1小时交易间隔
}
```

## 🏗️ 项目结构

```
zuoti/
├── app/                          # 前端应用
│   ├── pages/                    # 页面组件
│   │   ├── index.vue            # 主界面
│   │   ├── manual-trading.vue   # 手动交易
│   │   ├── backend-logs.vue     # 后端日志
│   │   └── system-config.vue    # 系统配置
│   ├── stores/                  # 状态管理
│   │   └── trading.ts           # 交易状态存储
│   ├── components/              # 公共组件
│   └── utils/                   # 工具函数
├── server/                      # 后端服务
│   ├── api/                     # API接口
│   │   └── trading/            # 交易相关API
│   ├── modules/                 # 业务模块
│   │   └── trading-bot/        # 交易机器人核心
│   ├── plugins/                 # Nuxt插件
│   ├── tasks/                   # 定时任务
│   └── utils/                   # 工具函数
├── types/                       # TypeScript类型定义
│   └── trading.ts              # 交易相关类型
├── data/                        # 数据持久化
│   ├── trading-config.json     # 系统配置
│   └── trading-data.json       # 交易数据
├── backtest/                    # 回测系统
│   ├── binance_2year_backtest.js # 回测主程序
│   └── data/                   # 回测数据
├── public/                      # 静态资源
└── logs/                        # 系统日志
```

## 🔧 核心模块说明

### 交易机器人（TradingBot）
- **位置**：`server/modules/trading-bot/index.ts`
- **功能**：整合所有模块，管理交易循环和状态转换
- **特点**：单例模式，线程安全，自动恢复

### 状态处理器（StateHandlers）
- **位置**：`server/modules/trading-bot/StateHandlers.ts`
- **功能**：处理不同交易状态的逻辑
- **特点**：状态模式，职责分离，易于扩展

### 订单管理器（OrderManager）
- **位置**：`server/modules/trading-bot/OrderManager.ts`
- **功能**：管理订单创建、查询、取消等操作
- **特点**：封装CCXT接口，统一错误处理

### 熔断管理器（CircuitBreakerManager）
- **位置**：`server/modules/trading-bot/CircuitBreakerManager.ts`
- **功能**：实现熔断机制，控制风险
- **特点**：可配置参数，自动恢复

### 数据管理器（DataManager）
- **位置**：`server/modules/trading-bot/DataManager.ts`
- **功能**：管理数据持久化和加载
- **特点**：JSON文件存储，自动备份

### AI分析服务（AIAnalysisService）
- **位置**：`server/utils/ai-analysis.ts`
- **功能**：提供基于DeepSeek API的智能市场分析
- **特点**：
  - 多维度技术指标分析（价格、移动平均线、RSI、成交量、支撑阻力位）
  - AI分析与本地技术指标加权计算
  - 智能缓存机制，减少API调用
  - 容错处理，API失败时自动降级
  - 提供详细的分析报告和技术指标数据

## 📱 使用指南

### 1. 首次使用
1. 注册币安账号并创建API密钥（建议先使用模拟交易）
2. 配置环境变量文件（.env）
3. 启动系统：`pnpm dev`
4. 访问 http://localhost:3000
5. 在系统配置中设置交易参数

### 2. 模拟交易测试
1. 确保 `isTestnet: true`
2. 设置较小的投资金额（如20 USDT）
3. 开启自动交易
4. 观察系统运行1-2天，确认策略有效性

### 3. 真实交易
1. 在模拟交易测试通过后
2. 切换 `isTestnet: false`
3. 设置合理的投资金额
4. 建议从小额开始，逐步增加

### 4. 监控与调整
1. 定期查看交易记录和统计
2. 根据市场情况调整参数
3. 关注系统日志和错误信息
4. 使用回测系统优化参数

## ⚠️ 安全提示

### 重要警告
1. **先模拟后真实**：务必先在模拟交易中测试至少1周
2. **API权限限制**：创建API密钥时只授予必要权限（读取、交易）
3. **资金安全**：不要将所有资金都用于自动交易
4. **定期检查**：每天检查系统运行状态和交易记录
5. **风险意识**：加密货币交易存在高风险，可能损失全部投资

### 建议配置
- 单次投资金额：不超过总资金的5%
- 最大持仓比例：不超过总资金的20%
- 每日亏损限额：不超过总资金的2%
- 定期提取利润：每周或每月提取部分利润

## 🔍 故障排除

### 常见问题

#### Q1: 无法连接到币安API
- 检查网络连接
- 确认API密钥是否正确
- 检查是否使用了正确的测试网URL
- 查看控制台错误日志

#### Q2: 订单一直未成交
- 可能是价格设置不合理
- 市场波动不够，振幅未达阈值
- 可以适当调整振幅阈值参数
- 检查保护机制是否过早取消订单

#### Q3: 数据丢失或状态异常
- 检查data目录是否有写入权限
- 查看系统日志文件
- 尝试手动重置系统状态
- 备份数据后重启系统

#### Q4: 系统运行缓慢
- 检查服务器资源使用情况
- 减少监控的交易对数量
- 增加交易循环间隔时间
- 优化数据库查询（如有）

### 日志查看
```bash
# 查看实时日志
tail -f logs/trading.log

# 查看错误日志
grep -i error logs/trading.log
```

## 📚 开发指南

### 代码规范
1. 使用TypeScript进行开发，严格类型检查
2. 遵循ESLint代码规范
3. 模块化组件化开发，遵循单一职责原则
4. 使用Pinia进行状态管理，类型定义完整
5. 所有API接口都有明确的类型定义

### 扩展开发
1. **添加新交易对**：修改 `types/trading.ts` 中的 `TradingSymbol` 类型
2. **修改交易策略**：编辑 `server/utils/strategy.ts`
3. **添加新保护机制**：在 `server/modules/trading-bot/` 下创建新模块
4. **修改UI界面**：编辑 `app/pages/` 下的Vue组件

### 测试建议
1. **单元测试**：对核心策略函数进行测试
2. **集成测试**：测试API接口和模块集成
3. **回测验证**：所有策略修改都应进行回测验证
4. **模拟交易测试**：在实际部署前进行模拟交易测试

## 🔮 未来规划

### 短期优化
- [ ] 添加更多技术指标支持（MACD, Bollinger Bands等）
- [ ] 支持更多交易对（XRP/USDT, ADA/USDT等）
- [ ] 优化UI界面，添加更多数据可视化
- [ ] 添加Telegram/邮件通知功能

### 中期规划
- [ ] 支持多交易所（OKX, Bybit等）
- [ ] 添加机器学习预测模块
- [ ] 实现多策略并行运行
- [ ] 开发移动端App

### 长期愿景
- [ ] 构建交易策略市场
- [ ] 实现社交交易功能
- [ ] 开发机构级交易系统
- [ ] 构建完整的DeFi交易生态

## 📄 许可证

MIT License - 详见 LICENSE 文件

## 🤝 贡献指南

欢迎提交Issue和Pull Request！在提交前请确保：

1. 代码符合项目规范
2. 添加相应的测试用例
3. 更新相关文档
4. 说明修改的目的和影响

## 📞 支持与反馈

如有问题或建议，请通过以下方式联系：

- GitHub Issues: [项目Issues页面](https://github.com/q573927428/zuoti/issues)
- 邮件支持：请通过GitHub Issues联系

---

**免责声明**：本项目仅供学习和研究使用。加密货币交易存在高风险，可能导致资金损失。使用本系统进行真实交易前，请确保您充分了解相关风险，并建议咨询专业财务顾问。作者不对任何交易损失负责。